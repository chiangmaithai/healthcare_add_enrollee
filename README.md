# Healthcare Enrollee Microservice

### Microservice to add new enrollees/dependents to healthcare

#### Business Requirements:

Using Spring Boot or Go, and your database of choice (PostgreSQL, MySQL, MongoDB -- any you'd like), develop a microservice for tracking the status of enrollees in a health care program.
- Enrollees must have an id, name, and activation status (true or false), and a birth date
- Enrollees may have a phone number (although they do not have to supply this)
- Enrollees may have zero or more dependents
- Each of an enrollee's dependents must have an id, name, and birth date

The application we will be building will need to be able to do these things:
- Add a new enrollee
- Modify an existing enrollee
- Remove an enrollee entirely
- Add dependents to an enrollee
- Remove dependents from an enrollee
- Modify existing dependents


## Applicaton

The application is created with Springboot
- server running on port 8000
- service registers itself with Eureka service running on port 8761
- Post requests accept json requests at url: /process-enrollee
- EnrolleeController handles incoming json requests mapped to RequestMessages.java 
- Incoming requests are passed to EnrolleeHandler which directs requests to a EnrolleeService
- EnrolleeService handles the business actions: add, modify and remove enrollee/dependents
- EnrolleeRepository handles database operations, Entities are: Enrollee and Dependents
- HealthCareException is the global exception handler
- EnrolleeController sends json response ResponseMessage

- Enrollee and dependent ids generated by Util.getNewId


## Testing

Junit tests were created to test the EnrolleeRepository and EnrolleeService.
Tools used during testing:
- running Eureka Service on port 8671
- running HSQLDB database on port 8701
- running microservice on port 8000
- using SQuirrel SQL client version 4.1.0
- SoapUI 5.6.0

#### Business requirements tested wit Junit

1. Add new enrollee - 
	test case - 
		EnrolleeRepositoryTest.whenSavingEnrolleeAndDependents_thenCorrect
		EnrolleeRepositoryTest.whenSavingEnrollee_thenCorrect

2. Modify an existing enrollee -
	test case
		EnrolleeServiceTest.whenModifyingEnrollee_thenCorrect

3. Remove an enrollee entirely
	test case
		EnrolleeRepositoryTest.whenSavingEnrolleeThenDeleleEnrollee_thenCorrect
		EnrolleeRepositoryTest.whenSavingEnrolleeThenDeleleEnrolleeAndDependents_thenCorrect

4. Add dependents
	test case - 
		EnrolleeRepositoryTest.whenSavingEnrolleeAndDependents_thenCorrect

5. Remove dependents from enrollee - 
	test case - 
		EnrolleeRepositoryTest.whenRemovingOneOfManyDependents_thenCorrect


6. Modify existing dependents 
	test case -
		EnrolleeServiceTest - whenModifyingEnrollee_thenCorrect

## Test Message

### Sample Request Message

```json

{
"user":"testuser",
"system":"system test",
"requestCode":"ADD_ENROLLEE",
"enrollee":{
	"id":null,
	"enrolleeId":"8ad83ce4-188a-43a2-becb-c52bd773431c",
	"name":"Irene Modified 2",
	"activationStatus":"FALSE",
	"birthDate":19900802,
	"phoneNumber":"8137485545",
	"ssn":"221111111",
	"lastDateModified":null,
	"createdDate":null,
	
	"dependentList":
		[
                  {
            "id": 807,
            "dependentId": "2cd9456d-68d6-4dad-a3a3-823cdb0daba0",
            "name": "Irene D1",
            "birthDate": 20200101,
            "ssn": "321111111",
            "lastDateModified": "2020-08-30T22:49:38.075",
            "createdDate": "2020-08-30T22:49:38.111"
         },
                  {
            "id": 809,
            "dependentId": "b66d91ef-68c2-4fa9-a62e-4a40c1aff52f",
            "name": "Irene D3",
            "birthDate": 20200103,
            "ssn": "521111111",
            "lastDateModified": "2020-08-30T22:57:27.301",
            "createdDate": "2020-08-30T22:57:27.303"
         }
		]
	}
}

```

### Sample Response Message

```json
{
   "messageId": "5ba6cb9b-86b4-4061-b983-9f056e3da032",
   "responseCode": "SUCCESS",
   "responseMessage": null,
   "enrollee":    {
      "id": 813,
      "enrolleeId": "32752b8f-e13f-4775-82aa-97512d9bf8e3",
      "name": "Irene Modified 2",
      "activationStatus": "FALSE",
      "birthDate": 19900802,
      "phoneNumber": "8137485545",
      "ssn": "221111111",
      "lastDateModified": "2020-08-30T23:08:40.897",
      "createdDate": null,
      "dependentList":       [
                  {
            "id": 814,
            "dependentId": "16445a51-b519-4223-8a17-5b83dda0b64a",
            "name": "Irene D1",
            "birthDate": 20200101,
            "ssn": "321111111",
            "lastDateModified": "2020-08-30T23:08:40.903",
            "createdDate": null
         },
                  {
            "id": 815,
            "dependentId": "3f886c1c-ace2-4b15-8d7e-dc18175f83f4",
            "name": "Irene D3",
            "birthDate": 20200103,
            "ssn": "521111111",
            "lastDateModified": "2020-08-30T23:08:40.904",
            "createdDate": null
         }
      ]
   },
   "createDate": "2020-08-30T23:08:40.931"
}
```


## Build Results

[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------< com.simms:add_new_enrollee_demo >-------------------
[INFO] Building service_registry_demo 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- maven-resources-plugin:3.1.0:resources (default-resources) @ add_new_enrollee_demo ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 1 resource
[INFO] Copying 0 resource
[INFO] 
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ add_new_enrollee_demo ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:3.1.0:testResources (default-testResources) @ add_new_enrollee_demo ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory C:\workspace\healthcare\src\test\resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ add_new_enrollee_demo ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.22.2:test (default-test) @ add_new_enrollee_demo ---
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
---
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 11, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] 
[INFO] --- maven-jar-plugin:3.2.0:jar (default-jar) @ add_new_enrollee_demo ---
[INFO] Building jar: C:\workspace\healthcare\target\add_new_enrollee_demo-0.0.1-SNAPSHOT.jar
[INFO] 
[INFO] --- spring-boot-maven-plugin:2.3.3.RELEASE:repackage (repackage) @ add_new_enrollee_demo ---
[INFO] Replacing main artifact with repackaged archive
[INFO] 
[INFO] --- maven-install-plugin:2.5.2:install (default-install) @ add_new_enrollee_demo ---
[INFO] Installing C:\workspace\healthcare\target\add_new_enrollee_demo-0.0.1-SNAPSHOT.jar to C:\Users\thoma\.m2\repository\com\simms\add_new_enrollee_demo\0.0.1-SNAPSHOT\add_new_enrollee_demo-0.0.1-SNAPSHOT.jar
[INFO] Installing C:\workspace\healthcare\pom.xml to C:\Users\thoma\.m2\repository\com\simms\add_new_enrollee_demo\0.0.1-SNAPSHOT\add_new_enrollee_demo-0.0.1-SNAPSHOT.pom
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  45.025 s
[INFO] Finished at: 2020-08-30T18:13:48-04:00
[INFO] ------------------------------------------------------------------------


## Start Up

2020-08-30 22:06:26.767  INFO 29908 --- [           main] com.simms.healthcare.ServiceApplication  : The following profiles are active: dev
2020-08-30 22:06:27.192  INFO 29908 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFERRED mode.
2020-08-30 22:06:27.245  INFO 29908 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 47ms. Found 1 JPA repository interfaces.
2020-08-30 22:06:27.466  INFO 29908 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory id=4f03737a-8494-3c4d-8348-3996b742d255
2020-08-30 22:06:27.707  INFO 29908 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8000 (http)
2020-08-30 22:06:27.713  INFO 29908 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2020-08-30 22:06:27.713  INFO 29908 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.37]
2020-08-30 22:06:27.803  INFO 29908 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2020-08-30 22:06:27.803  INFO 29908 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1021 ms
2020-08-30 22:06:27.911  INFO 29908 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'
2020-08-30 22:06:27.942  INFO 29908 --- [         task-1] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2020-08-30 22:06:28.055  WARN 29908 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.
2020-08-30 22:06:28.055  INFO 29908 --- [           main] c.n.c.sources.URLConfigurationSource     : To enable URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.
2020-08-30 22:06:28.059  INFO 29908 --- [         task-1] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 5.4.20.Final
2020-08-30 22:06:28.059  WARN 29908 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.
2020-08-30 22:06:28.059  INFO 29908 --- [           main] c.n.c.sources.URLConfigurationSource     : To enable URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.
2020-08-30 22:06:28.112  WARN 29908 --- [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2020-08-30 22:06:28.166  INFO 29908 --- [         task-1] o.hibernate.annotations.common.Version   : HCANN000001: Hibernate Commons Annotations {5.1.0.Final}
2020-08-30 22:06:28.249  INFO 29908 --- [         task-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2020-08-30 22:06:28.394  INFO 29908 --- [         task-1] com.zaxxer.hikari.pool.PoolBase          : HikariPool-1 - Driver does not support get/set network timeout for connections. (feature not supported)
2020-08-30 22:06:28.402  INFO 29908 --- [         task-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2020-08-30 22:06:28.418  INFO 29908 --- [         task-1] org.hibernate.dialect.Dialect            : HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2020-08-30 22:06:29.008  INFO 29908 --- [         task-1] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2020-08-30 22:06:29.013  INFO 29908 --- [         task-1] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2020-08-30 22:06:29.641  INFO 29908 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine local hostname
2020-08-30 22:06:30.895  INFO 29908 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine local hostname
2020-08-30 22:06:30.928  WARN 29908 --- [           main] ockingLoadBalancerClientRibbonWarnLogger : You already have RibbonLoadBalancerClient on your classpath. It will be used by default. As Spring Cloud Ribbon is in maintenance mode. We recommend switching to BlockingLoadBalancerClient instead. In order to use it, set the value of `spring.cloud.loadbalancer.ribbon.enabled` to `false` or remove spring-cloud-starter-netflix-ribbon from your project.
2020-08-30 22:06:31.016  INFO 29908 --- [           main] o.s.c.n.eureka.InstanceInfoFactory       : Setting initial instance status as: STARTING
2020-08-30 22:06:31.044  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Initializing Eureka in region us-east-1
2020-08-30 22:06:31.327  INFO 29908 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON encoding codec LegacyJacksonJson
2020-08-30 22:06:31.327  INFO 29908 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON decoding codec LegacyJacksonJson
2020-08-30 22:06:31.418  INFO 29908 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML encoding codec XStreamXml
2020-08-30 22:06:31.419  INFO 29908 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML decoding codec XStreamXml
2020-08-30 22:06:31.562  INFO 29908 --- [           main] c.n.d.s.r.aws.ConfigClusterResolver      : Resolving eureka endpoints via configuration
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Disable delta property : false
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Single vip registry refresh property : null
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Force full registry fetch : false
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Application is null : false
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Registered Applications size is zero : true
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Application version is -1: true
2020-08-30 22:06:31.688  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Getting all instance registry info from the eureka server
2020-08-30 22:06:31.770  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : The response status is 200
2020-08-30 22:06:31.772  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Starting heartbeat executor: renew interval is: 30
2020-08-30 22:06:31.774  INFO 29908 --- [           main] c.n.discovery.InstanceInfoReplicator     : InstanceInfoReplicator onDemand update allowed rate per min is 4
2020-08-30 22:06:31.777  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Discovery Client initialized at timestamp 1598839591776 with initial instances count: 0
2020-08-30 22:06:31.779  INFO 29908 --- [           main] o.s.c.n.e.s.EurekaServiceRegistry        : Registering application HEALTHCARE_ENROLLEE_SERVICE with eureka with status UP
2020-08-30 22:06:31.780  INFO 29908 --- [           main] com.netflix.discovery.DiscoveryClient    : Saw local status change event StatusChangeEvent [timestamp=1598839591780, current=UP, previous=STARTING]
2020-08-30 22:06:31.781  INFO 29908 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_HEALTHCARE_ENROLLEE_SERVICE/localhost:healthcare_enrollee_service:8000: registering service...
2020-08-30 22:06:31.938  INFO 29908 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8000 (http) with context path ''
2020-08-30 22:06:31.939  INFO 29908 --- [           main] .s.c.n.e.s.EurekaAutoServiceRegistration : Updating port to 8000
2020-08-30 22:06:31.975  INFO 29908 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_HEALTHCARE_ENROLLEE_SERVICE/localhost:healthcare_enrollee_service:8000 - registration status: 204
2020-08-30 22:06:33.112  INFO 29908 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine local hostname
2020-08-30 22:06:33.114  INFO 29908 --- [           main] DeferredRepositoryInitializationListener : Triggering deferred initialization of Spring Data repositories…
2020-08-30 22:06:33.318  INFO 29908 --- [           main] DeferredRepositoryInitializationListener : Spring Data repositories initialized!
2020-08-30 22:06:33.326  INFO 29908 --- [           main] com.simms.healthcare.ServiceApplication  : Started ServiceApplication in 9.618 seconds (JVM running for 10.235)

